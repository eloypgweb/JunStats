---
// Componente para cambiar entre tema claro y oscuro
import '../styles/ThemeToggle.css';
---

<div class="theme-toggle">
	<button 
		class="theme-btn theme-toggle-btn"
		type="button"
		aria-label="Cambiar tema"
		title="Cambiar entre tema claro y oscuro"
	>
		<span class="sun-icon">‚òÄÔ∏è</span>
		<span class="moon-icon">üåô</span>
	</button>
</div>

<script>
	// Tipos para el tema
	type Theme = 'light' | 'dark';

	// Funci√≥n para obtener el tema preferido
	function getPreferredTheme(): Theme {
		// Primero verificar si hay un tema guardado
		if (typeof localStorage !== 'undefined') {
			const savedTheme = localStorage.getItem('theme') as Theme;
			if (savedTheme && (savedTheme === 'light' || savedTheme === 'dark')) {
				return savedTheme;
			}
		}
		
		// Si no hay tema guardado, usar la preferencia del sistema
		return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
	}

	// Funci√≥n para aplicar el tema
	function setTheme(theme: Theme): void {
		document.documentElement.setAttribute('data-theme', theme);
		if (typeof localStorage !== 'undefined') {
			localStorage.setItem('theme', theme);
		}
		
		// Actualizar el estado visual de todos los botones
		const buttons = document.querySelectorAll('.theme-toggle-btn');
		buttons.forEach(button => {
			button.setAttribute('aria-pressed', theme === 'dark' ? 'true' : 'false');
			button.classList.toggle('dark-mode', theme === 'dark');
		});
	}

	// Funci√≥n para alternar tema
	function toggleTheme(): void {
		const currentTheme = document.documentElement.getAttribute('data-theme') as Theme;
		const newTheme: Theme = currentTheme === 'dark' ? 'light' : 'dark';
		setTheme(newTheme);
	}

	// Inicializar el tema al cargar la p√°gina
	function initTheme(): void {
		const theme = getPreferredTheme();
		setTheme(theme);
		
		// A√±adir event listener a todos los botones
		const buttons = document.querySelectorAll('.theme-toggle-btn');
		buttons.forEach(button => {
			button.addEventListener('click', toggleTheme);
		});
		
		// Escuchar cambios en la preferencia del sistema
		window.matchMedia('(prefers-color-scheme: dark)')
			.addEventListener('change', (e: MediaQueryListEvent) => {
				// Solo aplicar si no hay tema guardado por el usuario
				if (typeof localStorage === 'undefined' || !localStorage.getItem('theme')) {
					setTheme(e.matches ? 'dark' : 'light');
				}
			});
	}

	// Aplicar tema inmediatamente para evitar flash
	const theme = getPreferredTheme();
	document.documentElement.setAttribute('data-theme', theme);

	// Inicializar cuando el DOM est√© listo
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initTheme);
	} else {
		initTheme();
	}

	// Para navegaci√≥n con Astro (SPA mode)
	document.addEventListener('astro:page-load', initTheme);
</script>