---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import { SITE_TITLE } from '../consts';
import { getSupabaseServer } from '../lib/db/supabase-server';
import '../styles/players.css';

type Player = {
	id: number;
	dorsal: number;
	nombre: string;
	apellido: string;
	estatura: number;
	cumple: string;
	posicion: string;
	photo_url?: string;
};

let players: Player[] = [];
let error: string | null = null;

try {
	const supabase = getSupabaseServer();
	const { data, error: supabaseError } = await supabase
		.from('players')
		.select('*')
		.order('dorsal');
	
	if (supabaseError) {
		console.error('Supabase error:', supabaseError);
		throw new Error(supabaseError.message);
	}
	
	players = data || [];
} catch (e) {
	console.error('Error fetching players:', e);
	if (e instanceof Error) {
		error = e.message;
	} else {
		error = 'Error al cargar jugadores desde la base de datos';
	}
}
---

<!doctype html>
<html lang="es">
<head>
<BaseHead title={`Jugadores - ${SITE_TITLE}`} description="Plantilla del equipo de baloncesto JunStats" />
</head>
<body>
		<Header />
		<main>
			<section class="players-hero">
				<h1>ğŸ€ <span class="gradient-text">Plantilla del Equipo</span></h1>
				<p>Conoce a nuestros jugadores</p>
			</section>

			<section class="players-container">
				{error ? (
					<div class="error-message">
						<p>Error al cargar los jugadores: {error}</p>
					</div>
				) : players.length === 0 ? (
					<div class="no-players">
						<p>No hay jugadores disponibles en este momento.</p>
					</div>
				) : (
					<div class="players-grid">
						{players.map((player) => (
							<div class="player-card">
								<div class="player-info">
									<div class="player-number">#{player.dorsal}</div>
									<h2 class="player-name">{player.nombre} {player.apellido}</h2>
									<div class="player-details">
										<div class="detail-item">
											<span class="detail-icon">ğŸ€</span>
											<span class="detail-label">PosiciÃ³n:</span>
											<span class="detail-value">{player.posicion.charAt(0).toUpperCase() + player.posicion.slice(1)}</span>
										</div>
										<div class="detail-item">
											<span class="detail-icon">ğŸ“</span>
											<span class="detail-label">Altura:</span>
											<span class="detail-value">{player.estatura} m</span>
										</div>
										<div class="detail-item">
											<span class="detail-icon">ğŸ‚</span>
											<span class="detail-label">CumpleaÃ±os:</span>
											<span class="detail-value">{new Date(player.cumple).toLocaleDateString('es-ES', { day: 'numeric', month: 'long' })}</span>
										</div>
									</div>
								</div>
								{player.photo_url && (
									<div class="player-photo-container">
										<img src={player.photo_url} alt={`${player.nombre} ${player.apellido}`} class="player-photo" />
									</div>
								)}
							</div>
						))}
					</div>
				)}
			</section>
		</main>
		<Footer />
	</body>
</html>